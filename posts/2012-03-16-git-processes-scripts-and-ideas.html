<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Git Processes, Scripts and Ideas - willwolf.com</title>
        <link rel="stylesheet" href="../all.css" />
    </head>
    <body>

        <div class="sidebar">
            <a href="../" class="face-logo">
            </a>

            <div class="side-nav">
                <!-- <a href="/">About</a> -->
                <a href="../writing.html">Writing</a>
                <!--<a href="/projects.html">Projects</a>-->
                <a href="../reading.html">Reading</a>
                <!--<a href="/archive.html">Archive</a>-->
            </div>

            <div class="side-footer">
                <a class="twitter" target="_social" href="https://twitter.com/throughnothing">
                    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M16 3.038c-.59.26-1.22.437-1.885.517.677-.407 1.198-1.05 1.443-1.816-.634.37-1.337.64-2.085.79-.598-.64-1.45-1.04-2.396-1.04-1.812 0-3.282 1.47-3.282 3.28 0 .26.03.51.085.75-2.728-.13-5.147-1.44-6.766-3.42C.83 2.58.67 3.14.67 3.75c0 1.14.58 2.143 1.46 2.732-.538-.017-1.045-.165-1.487-.41v.04c0 1.59 1.13 2.918 2.633 3.22-.276.074-.566.114-.865.114-.21 0-.41-.02-.61-.058.42 1.304 1.63 2.253 3.07 2.28-1.12.88-2.54 1.404-4.07 1.404-.26 0-.52-.015-.78-.045 1.46.93 3.18 1.474 5.04 1.474 6.04 0 9.34-5 9.34-9.33 0-.14 0-.28-.01-.42.64-.46 1.2-1.04 1.64-1.7z" fill-rule="nonzero"></path></svg>
                </a>
                <a class="github" target="_social" href="https://github.com/throughnothing">
                    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M8 0C3.58 0 0 3.582 0 8c0 3.535 2.292 6.533 5.47 7.59.4.075.547-.172.547-.385 0-.19-.007-.693-.01-1.36-2.226.483-2.695-1.073-2.695-1.073-.364-.924-.89-1.17-.89-1.17-.725-.496.056-.486.056-.486.803.056 1.225.824 1.225.824.714 1.223 1.873.87 2.33.665.072-.517.278-.87.507-1.07-1.777-.2-3.644-.888-3.644-3.953 0-.873.31-1.587.823-2.147-.09-.202-.36-1.015.07-2.117 0 0 .67-.215 2.2.82.64-.178 1.32-.266 2-.27.68.004 1.36.092 2 .27 1.52-1.035 2.19-.82 2.19-.82.43 1.102.16 1.915.08 2.117.51.56.82 1.274.82 2.147 0 3.073-1.87 3.75-3.65 3.947.28.24.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.14.46.55.38C13.71 14.53 16 11.53 16 8c0-4.418-3.582-8-8-8"></path></svg>
                </a>
                <a class="linkedin" target="_social" href="https://www.linkedin.com/in/throughnothing/">
                    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M13.632 13.635h-2.37V9.922c0-.886-.018-2.025-1.234-2.025-1.235 0-1.424.964-1.424 1.96v3.778h-2.37V6H8.51v1.04h.03c.318-.6 1.092-1.233 2.247-1.233 2.4 0 2.845 1.58 2.845 3.637v4.188zM3.558 4.955c-.762 0-1.376-.617-1.376-1.377 0-.758.614-1.375 1.376-1.375.76 0 1.376.617 1.376 1.375 0 .76-.617 1.377-1.376 1.377zm1.188 8.68H2.37V6h2.376v7.635zM14.816 0H1.18C.528 0 0 .516 0 1.153v13.694C0 15.484.528 16 1.18 16h13.635c.652 0 1.185-.516 1.185-1.153V1.153C16 .516 15.467 0 14.815 0z" fill-rule="nonzero"></path></svg>
                </a>
                <a class="goodreads" target="_social" href="https://www.goodreads.com/user/show/7295031-will">
                    <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M13.022 10.63V.326h-1.37V2.26h-.043c-.14-.303-.32-.593-.56-.87-.24-.274-.51-.517-.82-.727-.31-.21-.64-.373-1.01-.49C8.85.06 8.46 0 8.04 0c-.805 0-1.53.15-2.16.446-.63.297-1.16.703-1.587 1.217-.427.515-.753 1.116-.978 1.804-.224.69-.337 1.417-.337 2.185 0 .797.094 1.547.283 2.25.19.703.49 1.315.91 1.837.42.52.94.93 1.58 1.22.64.29 1.41.44 2.31.44.83 0 1.55-.21 2.17-.63.62-.42 1.09-.98 1.41-1.68h.04v1.52c0 1.36-.28 2.4-.84 3.13-.56.72-1.48 1.09-2.76 1.09-.38 0-.75-.04-1.11-.12-.36-.08-.69-.21-.99-.38-.29-.18-.55-.4-.76-.69-.21-.29-.35-.64-.42-1.06H3.4c.045.59.21 1.1.49 1.53.283.43.64.78 1.066 1.06.427.27.91.47 1.445.6.54.13 1.09.2 1.66.2.92 0 1.69-.13 2.32-.37.63-.25 1.14-.6 1.53-1.07.4-.47.68-1.03.86-1.7.18-.67.28-1.42.28-2.24zm-4.98-.37c-.636 0-1.187-.126-1.65-.38-.464-.253-.85-.587-1.153-1-.31-.413-.53-.887-.68-1.423-.15-.537-.22-1.087-.22-1.653 0-.58.07-1.148.2-1.706.14-.558.36-1.055.66-1.49.3-.434.69-.786 1.15-1.054.46-.268 1.02-.402 1.67-.402s1.2.138 1.66.413c.45.276.83.638 1.12 1.087.29.45.5.95.63 1.5s.19 1.102.19 1.652c0 .566-.08 1.116-.23 1.653-.15.536-.38 1.01-.69 1.423-.31.413-.68.747-1.13 1-.45.254-.97.38-1.57.38z" fill-rule="nonzero"></path></svg>
                </a>
            </div>
        </div>

        <div class="content">
            
<div class="post">

  <h1>Git Processes, Scripts and Ideas</h1>
  <span class="post-date">16 Mar 2012</span>
  <hr />

  <p>Lately I’ve been refining some of my git processes (as well as learning a lot about git along the way). I thought I’d write up a post to share some of the ways i’ve been using git.</p>
<h2 id="workflow">Workflow</h2>
<p>Our typical workflow at <a href="https://www.crowdtilt.com">crowdtilt</a> is pretty standard. We have a <code>dev</code> branch, a <code>master</code> branch, and various feature/topic branches. We also make heavy use of github for pull requests/code reviews.</p>
<p>When I go to develop a new feature/bugfix, I start by creating a new branch off of the latest <code>dev</code>, and start coding. I often make many small commits along the way because I’m a strong believer in commit early, commit often. I also push my branch to github pretty frequently just to be on the safe side.</p>
<p>Once my feature branch has been tested, and is ready to be merged into <code>dev</code>, I rebase all of my small commits into 1. We try to keep all of our PR’s to 1 commit just to keep our git history clean, useful, and readable as a history of concise and (hopefully) small changes. To do this, I have been simply using:</p>
<pre><code>$ git rebase -i dev</code></pre>
<p>This will drop me into vim with a lits of all the commits between <code>dev</code>’s <code>HEAD</code> and my current branch’s <code>HEAD</code>. It will look something like this:</p>
<pre><code>pick 1dea3ff Commit #1
pick 57a5a28 Commit #2
pick 3f21ade Commit #3</code></pre>
<p>I simply squash all the commits into one by replacing <code>pick</code> with <code>s</code> on all but the first line. This gives me something like this:</p>
<pre><code>pick 1dea3ff Commit #1
s 57a5a28 Commit #2
s 3f21ade Commit #3</code></pre>
<p>This tells git that I want to squash all of these commits into one. Once I quit and save it’ll then let me give a new commit message for my new mega-commit.</p>
<p>Here I try to follow convention with a short summary on the first line, and then a lengthier description describing my feature/bugfix/whatever in a paragraph below that.</p>
<p>Once I have my branch neatly tidied up with one descriptive commit, it’s time to pull request.</p>
<h2 id="pull-requests-and-hub">Pull Requests and hub</h2>
<p>I love the github web interface for reviewing code and checking out diffs, but it is very tedious to go to the website, find your branch, and make the pull request through the web interface. Enter <a href="https://github.com/defunkt/hub">hub</a> – a wonderful command-line tool that lets you create pull requests (amongst lots of other cool things) right from the command line.</p>
<p>To do a pull request right from my coding directory, I can simply run:</p>
<pre><code>$ hub pull-request &quot;Pull Request Title&quot;</code></pre>
<p>The caveat here is that hub (and github, too) default all pull requests to merge into the <code>master</code> branch. We always merge into <code>dev</code>, and then merge <code>dev</code> into <code>master</code> when we are ready to deploy changes to production (I’ll talk more about our deploy processes in another article). So to get it to merge into <code>dev</code>, we must run the following:</p>
<pre><code>$ hub pull-request &quot;Pull Request Title&quot; -b dev</code></pre>
<p>This is closer to what we need, but by default what this will do is setup a pull request on github from <code>throughnothing:feature-branch</code> to <code>crowdtilt:dev</code>. It does this because it assumes that I want to do a pull request from my users fork to the original users repository. We don’t really have each developer fork our repos, we just all work on the same repo in our own branches, so we really want it to do a pull-request from <code>crowdtilt:feature-branch</code> to <code>crowdtilt:dev</code>. This means we need:</p>
<pre><code>$ hub pull-request &quot;Pull Request Title&quot; -b dev -h crowdtilt:feature-branch</code></pre>
<p>It seemed really simple at first, but now it’s a lot to type. Time for some <code>~/.bashrc</code> magic. To make things as simple as possible for our development process, I’ve written this little bash function to put in our <code>~/.bashrc</code> files to smooth things out:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="fu">pullreq()</span> <span class="kw">{</span>
    [ <span class="ex">-z</span> <span class="va">$BRANCH</span> ] <span class="kw">&amp;&amp;</span> <span class="va">BRANCH=</span><span class="st">&quot;dev&quot;</span>
    <span class="va">HEAD=$(</span><span class="fu">git</span> symbolic-ref HEAD <span class="op">2&gt;</span> /dev/null<span class="va">)</span>
    [ <span class="ex">-z</span> <span class="va">$HEAD</span> ] <span class="kw">&amp;&amp;</span> <span class="bu">return</span> <span class="co"># Return if no head</span>
    <span class="va">REMOTE=</span><span class="kw">`</span><span class="fu">cat</span> .git/config <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;remote </span><span class="dt">\&quot;</span><span class="st">origin</span><span class="dt">\&quot;</span><span class="st">&quot;</span> -A 2 <span class="kw">|</span> <span class="fu">tail</span> -n1 <span class="kw">|</span> <span class="fu">sed</span> <span class="st">'s/.*:\([^\/]*\).*/\1/'</span><span class="kw">`</span>

    <span class="ex">hub</span> pull-request -b <span class="va">$BRANCH</span> -h <span class="va">$REMOTE</span>:<span class="va">${HEAD#</span>refs/heads/<span class="va">}</span> <span class="va">$1</span>
<span class="kw">}</span></code></pre></div>
<p>This accepts a <code>BRANCH</code> environment variable that can be set, but will default to <code>dev</code> (which is pretty much 90+% of our use cases). It also parses the github user that the origin of the repository</p>
<p>Not only has <code>hub</code> greatly streamlined our pull request process, but when combined with the bash function, it eliminates errors of pull requesting feature branches to be merged into <code>master</code> (and even having them <em>accidentally</em> merged into master directly – that never happens, right?) instead of <code>dev</code>.</p>
<p>Using this script, when we’re ready to do a deploy and merge <code>dev</code> into <code>master</code> we simply can run (from the <code>dev</code> branch):</p>
<pre><code>$ BRANCH=master pullreq</code></pre>
<p>And the pull request will be created to merge dev into master so we can review it on github.</p>
<h2 id="managing-branch-chaos">Managing Branch Chaos</h2>
<p>I said earlier that I was a believer in commit early, commit often. Well, I’m also a believer in small branches. We pretty much make branches for everything. Even if it’s just a simple css change, or a one-line bug-fix, I like to quarantine changesets into a branch of their own. So many times i’ll be caught in the middle of a simple change and have to go tend to something else. Having branches lets me quickly commit “saving my place”, or “WIP” in my branch, and get to work looking at something in another branch. My feature branch will be there waiting for me when I’m ready to go back to it.</p>
<p>Additionally, smaller branches make for smaller merges, which are easier to review, and less prone to introducing glaring errors that could have been caught.</p>
<p>A side-effect of all this branching and pushing and merging is that you can quickly get confused about which branches have been merged and which haven’t. The list of branches shown on github and on the command line grows to make it harder for you to find the branches you still care about. So of course, we can delete the branches as we go, but this is very tedious to do so frequently as you have to delete the branch locally, and on github:</p>
<pre><code>$ pullreq
# Review code on github
$ git checkout dev &amp;&amp; git merge feature-branch &amp;&amp; git push origin dev
$ gut branch -D feature-branch  # delete feature-branch locally
$ git push origin :feature-branch # delete feature-branch on github</code></pre>
<p>Enter more <code>~/.bashrc</code> goodness. I wanted a way to streamline this process as well because i was typing the above waaay too frequently, so I came up with two handy bash functions:</p>
<pre><code>git_purge_local_branches() {
  [ -z $1 ] &amp;&amp; return
  BRANCHES=`git branch --merged $1 | grep -v '^*' | grep -v 'master' | grep -v 'dev' | tr -d '\n'`
  echo &quot;Running: git branch -d $BRANCHES&quot;
  git branch -d $BRANCHES
}

git_purge_remote_branches() {
  [ -z $1 ] &amp;&amp; return
  git remote prune origin

  BRANCHES=`git branch -r --merged $1 | grep 'origin' | grep -v '/master$' | grep -v '/dev$' | sed 's/origin\//:/g' | tr -d '\n'`
  echo &quot;Running: git push origin $BRANCHES&quot;
  git push origin $BRANCHES
}</code></pre>
<p><code>git_purge_local_branches()</code> will – as the name implies – purge local branches that have been merged into the branch you give it. And <code>git_purge_remote_branches()</code> will do the same but it will remove the branches from the <code>origin</code> remote. So every now and then, when we get a lot of branches hanging around getting in our way, we can clean them up with:</p>
<pre><code>$ git_purge_local_branches dev
$ git_purge_remote_branches dev</code></pre>
<p>And of course, because running 2 commands just became too much, I created <code>git_purge</code>…one purge to rule them all:</p>
<pre><code>git_purge() {
  branch=$1
  [ -z $branch ] &amp;&amp; branch=&quot;dev&quot;
  git_purge_local_branches $branch
  git_purge_remote_branches $branch
}</code></pre>
<p>So now its super easy to manage our branch chaos. When I start to see too many branches building up, I can simply <code>git_purge</code> and it’ll wipe out any branches locally and on the origin that have already been merged into dev. Then we’re back to a blissful state of branch zen.</p>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>That pretty much sums up my current git processes. I really enjoy how streamlined things have become, how well our processes work, and how easy it is to keep our branches clean and clutter-free while at the same time encouraging us to branch, branch, branch!</p>
<p>How are you using git? Tell me how I can make my workflow even better and more kick-ass :)</p>

</div>

        </div>

        
    </body>
</html>